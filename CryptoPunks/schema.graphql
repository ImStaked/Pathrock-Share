enum TraitType {
  TYPE
  ACCESSORY
}

enum EventType {
  ASSIGN
  TRANSFER
  ASK_CREATED
  ASK_REMOVED
  BID_CREATED
  BID_REMOVED
  SALE
  WRAP
  UNWRAP
}

enum OfferType {
  BID
  ASK
}

type NFT @entity {
  id: ID!
  contract: Contract
  numberOfTransfers: BigInt!
  numberOfSales: BigInt!
  tokenId: BigInt!
  owner: Account!
  "All events"
  events: [Event!]! @derivedFrom(field: "nft")
  currentAsk: Ask
  currentBid: Bid
}

type Event @entity {
  id: ID!
  contract: Contract
  from: Account
  to: Account
  amount: BigInt
  nft: NFT #nullable because punk doesn't appear in all events
  type: EventType!
  logNumber: BigInt!
  blockNumber: BigInt!
  blockHash: Bytes!
  txHash: Bytes!
  timestamp: BigInt!
}

type Account @entity {
  id: Bytes!
  punksOwned: [Punk!] @derivedFrom(field: "owner")
  bought: [Sale!]! @derivedFrom(field: "to")
  nftsOwned: [NFT!]! @derivedFrom(field: "owner")
  assigned: [Assign!]! @derivedFrom(field: "to")
  sent: [Transfer!]! @derivedFrom(field: "from")
  received: [Transfer!]! @derivedFrom(field: "to")
  bids: [Bid!]! @derivedFrom(field: "from")
  asks: [Ask!]! @derivedFrom(field: "from")
  numberOfPunksOwned: BigInt!
  numberOfPunksAssigned: BigInt!
  numberOfTransfers: BigInt!
  numberOfSales: BigInt!
  numberOfPurchases: BigInt!
  totalSpent: BigInt!
  totalEarned: BigInt!
  averageAmountSpent: BigInt!
  accountUrl: String!
}

type Punk @entity {
  id: ID!
  transferedTo: Account
  assignedTo: Account
  purchasedBy: Account
  metadata: MetaData
  contract: Contract
  tokenId: BigInt!
  owner: Account!
  wrapped: Boolean!
  events: [Event!]! @derivedFrom(field: "nft")
  currentAsk: Ask
  currentBid: Bid
  currentAskCreated: AskCreated
  currentBidCreated: BidCreated
  numberOfTransfers: BigInt!
  numberOfSales: BigInt!
  currentAskRemoved: AskRemoved
  currentBidRemoved: BidRemoved
  totalAmountSpentOnPunk: BigInt!
  averageSalePrice: BigInt!
}

type MetaData @entity {
  id: ID!
  tokenId: BigInt!
  tokenURI: String!
  image: String
  svg: String
  contractURI: String!
  punk: Punk!
  traits: [Trait!]!
}

type Trait @entity {
  id: ID!
  type: TraitType!
  metaDatas: [MetaData!]! @derivedFrom(field: "traits")
  numberOfNfts: BigInt!
}

type Offer @entity {
  id: ID!
  from: Account!
  open: Boolean!
  amount: BigInt!
  nft: NFT
  created: Event
  removed: Event
  offerType: OfferType!
}

type Ask @entity {
  id: ID!
  from: Account!
  open: Boolean!
  amount: BigInt!
  nft: NFT
  created: Event
  removed: Event
  offerType: OfferType!
}

type Bid @entity {
  id: ID!
  from: Account!
  open: Boolean!
  amount: BigInt!
  nft: NFT
  created: Event
  removed: Event
  offerType: OfferType!
}

type Contract @entity {
  id: ID!
  symbol: String
  name: String
  totalSupply: BigInt!
  totalSales: BigInt!
  totalAmountTraded: BigInt!
  imageHash: String
}

type Assign @entity(immutable: true) {
  id: ID!
  contract: Contract
  nft: NFT
  to: Account
  amount: BigInt
  from: Account
  type: EventType!
  logNumber: BigInt!
  blockNumber: BigInt!
  blockHash: Bytes!
  txHash: Bytes!
  timestamp: BigInt!
}

type Sale @entity(immutable: true) {
  id: ID!
  to: Account
  amount: BigInt
  from: Account
  contract: Contract
  nft: NFT
  logNumber: BigInt!
  type: EventType!
  blockNumber: BigInt!
  blockHash: Bytes!
  txHash: Bytes!
  timestamp: BigInt!
}

type AskCreated @entity(immutable: true) {
  id: ID!
  from: Account
  to: Account
  ask: Ask
  amount: BigInt
  contract: Contract
  nft: NFT
  logNumber: BigInt!
  type: EventType!
  blockNumber: BigInt!
  blockHash: Bytes!
  txHash: Bytes!
  timestamp: BigInt!
}

type BidCreated @entity(immutable: true) {
  id: ID!
  from: Account
  to: Account
  bid: Bid
  amount: BigInt
  contract: Contract
  nft: NFT
  logNumber: BigInt!
  type: EventType!
  blockNumber: BigInt!
  blockHash: Bytes!
  txHash: Bytes!
  timestamp: BigInt!
}

type BidRemoved @entity(immutable: true) {
  id: ID!
  from: Account
  to: Account
  amount: BigInt
  bid: Bid!
  contract: Contract
  nft: NFT
  logNumber: BigInt!
  type: EventType!
  blockNumber: BigInt!
  blockHash: Bytes!
  txHash: Bytes!
  timestamp: BigInt!
}

type AskRemoved @entity(immutable: true) {
  id: ID!
  ask: Ask!
  from: Account
  to: Account
  amount: BigInt
  contract: Contract
  nft: NFT
  logNumber: BigInt!
  type: EventType!
  blockNumber: BigInt!
  blockHash: Bytes!
  txHash: Bytes!
  timestamp: BigInt!
}

type Transfer @entity(immutable: true) {
  id: ID!
  from: Account
  to: Account
  amount: BigInt
  contract: Contract
  nft: NFT
  logNumber: BigInt!
  type: EventType!
  blockNumber: BigInt!
  blockHash: Bytes!
  txHash: Bytes!
  timestamp: BigInt!
}

type CToken
  @entity { #TransferEvents
  "TxHash + logNumber" #This ID/Entity is used for referencing events in the same transaction
  id: ID!
  from: Account!
  to: Account!
  owner: String!
  amount: BigInt
  punkId: String
  referenceId: String!
  blockNumber: BigInt!
  blockHash: Bytes!
  txHash: Bytes!
  timestamp: BigInt!
}

type Wrap @entity(immutable: true) {
  id: ID!
  from: Account
  to: Account
  amount: BigInt
  contract: Contract
  nft: NFT
  logNumber: BigInt!
  type: EventType!
  blockNumber: BigInt!
  blockHash: Bytes!
  txHash: Bytes!
  timestamp: BigInt!
}

type Unwrap @entity(immutable: true) {
  id: ID!
  from: Account
  to: Account
  amount: BigInt
  contract: Contract
  nft: NFT
  logNumber: BigInt!
  type: EventType!
  blockNumber: BigInt!
  blockHash: Bytes!
  txHash: Bytes!
  timestamp: BigInt!
}

type UserProxy @entity {
  id: ID!
  user: Account!
  blockNumber: BigInt!
  blockHash: Bytes!
  txHash: Bytes!
  timestamp: BigInt!
}

type EpnsNotificationCounter @entity {
  id: ID!
  totalCount: BigInt!
}

type EpnsPushNotification @entity {
  id: ID!
  notificationNumber: BigInt!
  recipient: String!
  notification: String!
}
